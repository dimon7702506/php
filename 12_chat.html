<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Chat</title>
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <script type="text/javascript" src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
</head>
<body>

<form class="container" style="margin-top: 10px" id="msg_form">
    <div class="form-group row">
        <label class="col-sm-2 col-form-label">User name</label>
        <div class="col-sm-10">
            <input for="UserName" class="form-control" id="UserName" required name="UserName" maxlength="20" style="width: 120px">
        </div>
    </div>
    <div class="form-group row">
        <label class="col-sm-2 col-form-label">Message</label>
        <div class="col-sm-10">
            <input for="Message" class="form-control" id="Message" required name="Message" maxlength="60">
        </div>
    </div>
    <button type="submit" class="btn btn-primary" style="margin-bottom: 10px" id="send">Send message</button>
</form>
<div class="container">
    <div class="form-group">
        <textarea class="form-control" id="Chat" rows="15" disabled></textarea>
    </div>
</div>
<script type="text/javascript">
    var param_microtime;

    setInterval(check_messages, 2000);

    function check_messages() {
        $.ajax({
            url: '12_send.php',
            type: 'post',
            data: param_microtime,
            success: function (response) {
                var chat = $('#Chat');
                //chat.html(response.param_time);
                var text;
                text = '';
                for (var i = 0; i < response.messages.length; i++) {
                    text = text + "[" + response.messages[i]['time']+"]   " +
                        response.messages[i]['user'] + "    =>   " + response.messages[i]['message'] + "\n";
                }
                chat.html(text);
                param_microtime = response.param_time;
            }
        })
    }

    $(function () {
        var btn = $('#send');
        btn.click(function (e) {
            e.preventDefault();
            var form_data = $('#msg_form').serialize();
            $.ajax({
                url: '12_send.php',
                type: 'post',
                data: form_data,
                success: function (response) {
                    var chat = $('#Chat');
                    //chat.html(response.param_time);
                    var text;
                    text = '';
                    for (var i = 0; i < response.messages.length; i++) {
                        text = text + "[" + response.messages[i]['time']+"]   " +
                            response.messages[i]['user'] + "    =>   " + response.messages[i]['message'] + "\n";
                    }
                    chat.html(text);
                },
                error: function (response) {
                    alert('Error !!!');
                    console.log(response.param_time);
                },
                complete: function () {
                    var mas = document.getElementById('Message');
                    mas.value = '';
                }
            });
        });
    });
</script>
</body>
</html>